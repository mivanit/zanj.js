<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ZANJ demo</title>
  </head>
  <body>
    <h3>demo minimal</h3>
    <input id="base" value="demo" />
    <button id="load">load</button>
    <button id="mean" disabled>mean(big_array)</button>
    <pre id="out"></pre>

    <script src="src/array.js"></script>
    <script src="src/zanj.js"></script>
    <script>
      const out = document.getElementById("out");
      const log = (t) => out.textContent += t + "\n";

      let root = null;

      document.getElementById("load").onclick = async () => {
        const base = document.getElementById("base").value.trim();
        log("loading from " + base);
        try {
          const zl = new ZanjLoader({ baseUrl: base });
          root = await zl.loadRoot();
          log("keys: " + Object.keys(root).join(", "));
          document.getElementById("mean").disabled = false;
        } catch (e) {
          log("error: " + e);
        }
      };

      document.getElementById("mean").onclick = async () => {
        if (!root || !root.big_array) return log("no big_array");
        log("fetching big_array.npy ...");
        const arr = await root.big_array.load();
        const data = arr.data;
        let s = 0;
        for (let i = 0; i < data.length; i++) s += data[i];
        log("mean = " + s / data.length);
      };
    </script>
  </body>
</html>
