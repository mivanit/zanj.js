<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>ZANJ demo</title>
</head>

<body>
  <h3>demo minimal</h3>
  <!-- <input id="base" value="demo" /> --> path: <span id="base"></span>
  <button id="load">load</button>
  <button id="big_array" disabled>load big_array</button>
  <button id="big_list" disabled>load big_list</button>
  <button id="test_inline" disabled>test inline arrays</button>
  <pre id="out"></pre>
  <script src="src/array.js"></script>
  <script src="src/zanj.js"></script>
  <script>
    BASE_PATH = "demo";
    document.getElementById("base").textContent = BASE_PATH;

    const out = document.getElementById("out");
    const log = (t) => out.textContent += t + "\n";

    let data = null;

    document.getElementById("load").onclick = async () => {
      log("loading from " + BASE_PATH);
      try {
        data = await (new ZanjLoader(BASE_PATH)).read();
        log("keys: " + Object.keys(data).join(", "));
        document.getElementById("big_array").disabled = false;
        document.getElementById("big_list").disabled = false;
        document.getElementById("test_inline").disabled = false;

      } catch (e) {
        log("error: " + e);
      }
    };

    document.getElementById("big_array").onclick = async () => {
      log("fetching big_array.npy ...");
      const arr = await data.big_array;
      log("big_array.shape = " + arr.shape);
      log("big_array.dtype = " + arr.dtype);
      log("big_array[0] = " + arr.data[0]);
    };

    document.getElementById("big_list").onclick = async () => {
      log("fetching big_list ...");
      log(data.big_list[0])
      const lst = await data.big_list;
      log("len(big_list) = " + lst.length)
      log("big_list[0] = " + lst[0]);
    };

    document.getElementById("test_inline").onclick = async () => {
      log("\n=== Testing inline arrays ===");

      if (!data.inline_arrays) {
        log("No inline_arrays found - regenerate demo with: python make_demo.py");
        return;
      }

      const inline = data.inline_arrays;

      // Test small_list_meta
      log("\n1. small_list_meta:");
      log("  shape: " + inline.small_list_meta.shape);
      log("  dtype: " + inline.small_list_meta.dtype);
      log("  data: " + Array.from(inline.small_list_meta.data).join(", "));

      // Test small_b64_meta
      log("\n2. small_b64_meta:");
      log("  shape: " + inline.small_b64_meta.shape);
      log("  dtype: " + inline.small_b64_meta.dtype);
      log("  data: " + Array.from(inline.small_b64_meta.data).join(", "));

      // Test small_hex_meta
      log("\n3. small_hex_meta:");
      log("  shape: " + inline.small_hex_meta.shape);
      log("  dtype: " + inline.small_hex_meta.dtype);
      log("  data: " + Array.from(inline.small_hex_meta.data).join(", "));

      // Test matrix_2x3
      log("\n4. matrix_2x3:");
      log("  shape: " + inline.matrix_2x3.shape);
      log("  dtype: " + inline.matrix_2x3.dtype);
      log("  data: " + Array.from(inline.matrix_2x3.data).join(", "));
      log("  element[0,0]: " + inline.matrix_2x3.get(0, 0));
      log("  element[1,2]: " + inline.matrix_2x3.get(1, 2));

      // Test zero_dim
      log("\n5. zero_dim:");
      log("  shape: " + inline.zero_dim.shape);
      log("  dtype: " + inline.zero_dim.dtype);
      log("  value: " + inline.zero_dim.data[0]);

      log("\nâœ“ All inline arrays loaded successfully!");
    };
  </script>
</body>

</html>